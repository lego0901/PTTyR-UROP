
%\documentclass[a4paper,11pt]{article}
\documentclass{article}

\usepackage[hangul]{kotex}
\usepackage{woosung_hw}
\usepackage{woosung_math}
\usepackage{mathtools}
\usepackage{stmaryrd}
\usepackage{bussproofs}

%\usepackage[bitstream-charter]{mathdesign}
%\usepackage[T1]{fontenc}

\setlength{\hoffset}{-25pt}
\addtolength{\textwidth}{50pt}
\setlength{\voffset}{-60pt}
\addtolength{\textheight}{130pt}

\newcommand{\w}[1]{\ensuremath{\textit{#1}}}
\newcommand{\x}{\times}
\newcommand{\rem}{\mtt{\%}}
\newcommand{\rar}{\rightarrow}
\newcommand{\Rar}{\Rightarrow}
\newcommand{\U}{\cup}
\newcommand{\join}{\sqcup}
\newcommand{\ttt}[1]{\texttt{#1}}
\newcommand{\mtt}[1]{\mathtt{#1}}
\newcommand{\bigspace}{\,\,\,\,\,\,\,\,}

\newcommand{\op}[2]{\mtt{#1(}#2\mtt{)}}
\newcommand{\module}[3]{\mtt{#1(}#2\mtt{)(}#3\mtt{)}}
\newcommand{\conc}{\mtt{@}}
\newcommand{\ind}[1]{\mtt{[}#1\mtt{]}}
\newcommand{\indr}[2]{\mtt{[}#1\mtt{:}#2\mtt{]}}
\newcommand{\ifs}[3]{\mtt{if}\,\,#1\,\,\mtt{then}\,\,#2\,\,\mtt{else}\,\,#3}


\begin{document}

\subsection*{\texttt{torch.Tensor.size}}%{{{
%%% Not Sure
\begin{align*}
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c
    \end{array}
  }
  {
    \sigma \vdash E.\op{size}{} \Rar shapeToTuple(e), c
  }
\end{align*}

\begin{align*}
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      c' = \{ (k \geq 1) \land (0 \leq n < k) \}
    \end{array}
  }
  {
    \sigma \vdash E.\op{size}{n} \Rar e\ind{n+1}, c \cup c'
  }
\end{align*}%}}}

\subsection*{\texttt{torch.tensor}}%{{{
\begin{align*}
  \frac
  {
    \sigma \vdash {E} \Rar e, c
  }
  {
    \sigma \vdash \op{tensor}{E} \Rar e, c
  }
\end{align*}%}}}

\subsection*{\texttt{torch.Tensor.shape}}%{{{
%%% Not Sure
\begin{align*}
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c
    \end{array}
  }
  {
    \sigma \vdash E.\mtt{shape} \Rar shapeToTuple(e), c
  }
\end{align*}%}}}

\subsection*{\texttt{torch.range}}%{{{
\begin{align*}
  \frac
  {
    \begin{array}{l}
      d \neq 0\\
      (e-s)/d > 0
    \end{array}
  }
  {
    \sigma \vdash \op{range}{s, e, d} \Rar (1+\lfloor (e-s)/d \rfloor), \emptyset
  }
  \tag*{Default: $s = 0, d = 1$}
\end{align*}%}}}

\subsection*{\texttt{torch.Tensor.item}}%{{{
\begin{align*}
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      c' = \{ (\forall i = 1, 2, \dots, k,\: e[i] = 1) \}
    \end{array}
  }
  {
    \sigma \vdash E.\op{item}{} \Rar (), c \cup c'
  }
\end{align*}%}}}

\subsection*{\texttt{torch.split}}%{{{
\begin{align*}
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      e_1 = (n) \conc e\indr{2}{k} \\
      e_2 = (n) \conc e\indr{2}{k} \\
      \bigspace \cdots \\
      e_{l-1} = (n) \conc e\indr{2}{k} \\
      e_l = (n') \conc e\indr{2}{k}\bigspace
        \text{where $e \ind{1} = n(l-1) + n'$, $0 < n' \leq n$} \\
      c' = \{ (k \geq 1) \}
    \end{array}
  }
  {
    \sigma \vdash \op{split}{E, n} \Rar (e_1, e_2, \dots, e_l), c \cup c'
  }
  \tag*{$l$-원소 tuple 형태로 반환}
\end{align*}

\begin{align*}
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      e_1 = (n_1) \conc e\indr{2}{k} \\
      e_2 = (n_2) \conc e\indr{2}{k} \\
      \bigspace \cdots \\
      e_l = (n_l) \conc e\indr{2}{k} \\
      c' = \{ (k \geq 1) \land (e \ind{1} = n_1 + n_2 + \cdots + n_l) \}
    \end{array}
  }
  {
    \sigma \vdash \op{split}{E, \ind{n_1, n_2, \dots, n_l}}
      \Rar (e_1, e_2, \dots, e_l), c \cup c'
  }
  \tag*{$l$-원소 tuple 형태로 반환}
\end{align*}

\begin{align*}
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      e_1 = e\indr{1}{x} \conc (n) \conc e\indr{x+2}{k} \\
      e_2 = e\indr{1}{x} \conc (n) \conc e\indr{x+2}{k} \\
      \bigspace \cdots \\
      e_{l-1} = e\indr{1}{x} \conc (n) \conc e\indr{x+2}{k} \\
      e_l = e\indr{1}{x} \conc (n') \conc e\indr{x+2}{k} \bigspace
        \text{where $e \ind{1} = n(l-1) + n'$, $0 < n' \leq n$} \\
      c' = \{ (k \geq 1) \land (0 \leq x < k) \}
    \end{array}
  }
  {
    \sigma \vdash \op{split}{E, n, x} \Rar (e_1, e_2, \dots, e_l), c \cup c'
  }
  \tag*{$l$-원소 tuple 형태로 반환}
\end{align*}

\begin{align*}
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      e_1 = e\indr{1}{x} \conc (n_1) \conc e\indr{x+2}{k} \\
      e_2 = e\indr{1}{x} \conc (n_2) \conc e\indr{x+2}{k} \\
      \bigspace \cdots \\
      e_l = e\indr{1}{x} \conc (n_l) \conc e\indr{x+2}{k} \\
      c' = \{ (k \geq 1) \land (0 \leq x < k) \land
        (e \ind{x+1} = n_1 + n_2 + \cdots + n_l) \}
    \end{array}
  }
  {
    \sigma \vdash \op{split}{E, \ind{n_1, n_2, \dots, n_l}, x}
      \Rar (e_1, e_2, \dots, e_l), c \cup c'
  }
  \tag*{$l$-원소 tuple 형태로 반환}
\end{align*}%}}}

\subsection*{\texttt{torch.zeros}, \texttt{torch.rand}, \texttt{torch.randn}}%{{{
\begin{align*}
  \forall \mtt{ft} \in \{\mtt{zeros}, \mtt{rand}, \mtt{randn}\},
  \bigspace
  \frac
  {
  }
  {
    \sigma \vdash \op{ft}{t_1, t_2, \dots, t_l} \Rar (t_1, t_2, \dots, t_l),
      \emptyset
  }
\end{align*}%}}}

\subsection*{\texttt{torch.mode}}%{{{
\begin{align*}
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      e' = \ifs{k = 0}{e}{e \indr{1}{k-1}} \\
    \end{array}
  }
  {
    \sigma \vdash \op{mode}{E} \Rar (e', e'), c
  }
  \tag*{tuple 형태로 반환}
\end{align*}

\begin{align*}
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      e' = e \indr{1}{n} \conc e \indr{n+2}{k} \\
      c' = \{ (k \geq 1) \land (0 \leq n < k) \}
    \end{array}
  }
  {
    \sigma \vdash \op{mode}{E, n} \Rar (e', e'), c \cup c'
  }
  \tag*{tuple 형태로 반환}
\end{align*}

\begin{align*}
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      e' = e \indr{1}{n} \conc (1) \conc e \indr{n+2}{k} \\
      c' = \{ (k \geq 1) \land (0 \leq n < k) \}
    \end{array}
  }
  {
    \sigma \vdash \op{mode}{E, n, True} \Rar (e', e'), c \cup c'
  }
  \tag*{tuple 형태로 반환}
\end{align*}

\begin{align*}
  \frac
  {
    \sigma \vdash \op{mode}{E, n} \Rar (e, e), c
  }
  {
    \sigma \vdash \op{mode}{E, n, False} \Rar (e, e), c
  }
  \tag*{tuple 형태로 반환}
\end{align*}%}}}

\subsection*{\texttt{torch.randint}}%{{{
\begin{align*}
  \frac
  {
  }
  {
    \sigma \vdash \op{randint}{low, high, e_s} \Rar e_s, \emptyset
  }
\end{align*}

\begin{align*}
  \frac
  {
  }
  {
    \sigma \vdash \op{randint}{high, e_s} \Rar e_s, \emptyset
  }
\end{align*}%}}}

\subsection*{\texttt{torch.max}, \texttt{torch.min}}%{{{
\begin{align*}
  \forall \mtt{ft} \in \{\mtt{min}, \mtt{max}\},
  \bigspace
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar \_, c
    \end{array}
  }
  {
    \sigma \vdash \op{ft}{E} \Rar (), c
  }
\end{align*}

\begin{align*}
  \forall \mtt{ft} \in \{\mtt{min}, \mtt{max}\},
  \bigspace
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      e' = e \indr{1}{n} \conc e \indr{n+2}{k} \\
      c' = \{ (k \geq 1) \land (0 \leq n < k) \}
    \end{array}
  }
  {
    \sigma \vdash \op{ft}{E, n} \Rar (e', e'), c \cup c'
  }
  \tag*{tuple 형태로 반환}
\end{align*}

\begin{align*}
  \forall \mtt{ft} \in \{\mtt{min}, \mtt{max}\},
  \bigspace
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      e' = e \indr{1}{n} \conc (1) \conc e \indr{n+2}{k} \\
      c' = \{ (k \geq 1) \land (0 \leq n < k) \}
    \end{array}
  }
  {
    \sigma \vdash \op{ft}{E, n, True} \Rar (e', e'), c \cup c'
  }
  \tag*{tuple 형태로 반환}
\end{align*}

\begin{align*}
  \forall \mtt{ft} \in \{\mtt{min}, \mtt{max}\},
  \bigspace
  \frac
  {
    \sigma \vdash \op{ft}{E, n} \Rar (e, e), c
  }
  {
    \sigma \vdash \op{ft}{E, n, False} \Rar (e, e), c
  }
  \tag*{tuple 형태로 반환}
\end{align*}

\begin{align*}
  \forall \mtt{ft} \in \{\mtt{min}, \mtt{max}\},
  \bigspace
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E_1 \Rar e_1, c_1 \\
      \sigma \vdash E_2 \Rar e_2, c_2
    \end{array}
  }
  {
    \sigma \vdash \op{ft}{E_1, E_2} \Rar broadcast(e_1, e_2),
      c_1 \cup c_2 \cup broadcastable(e_1, e_2)
  }
\end{align*}%}}}

\subsection*{\texttt{torch.sum}, \texttt{torch.mean}}%{{{
\begin{align*}
  \forall \mtt{ft} \in \{\mtt{sum}, \mtt{mean}\},
  \bigspace
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar \_, c
    \end{array}
  }
  {
    \sigma \vdash \op{ft}{E} \Rar (), c
  }
\end{align*}

\begin{align*}
  \forall \mtt{ft} \in \{\mtt{sum}, \mtt{mean}\},
  \bigspace
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      e' = e \indr{1}{n} \conc e \indr{n+2}{k} \\
      c' = \{ (k \geq 1) \land (0 \leq n < k) \}
    \end{array}
  }
  {
    \sigma \vdash \op{ft}{E, n} \Rar e', c \cup c'
  }
\end{align*}

\begin{align*}
  \forall \mtt{ft} \in \{\mtt{sum}, \mtt{mean}\},
  \bigspace
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      e_1 = \ifs{1 \in \{n_1, n_2, \dots, n_r\}}{()}{(e[1])} \\
      e_2 = \ifs{2 \in \{n_1, n_2, \dots, n_r\}}{()}{(e[2])} \\
      \bigspace \cdots \\
      e_k = \ifs{k \in \{n_1, n_2, \dots, n_r\}}{()}{(e[k])} \\
      e' = e_1 \conc e_2 \conc \cdots \conc e_k \\
      c' = \{ (k \geq 1) \land (\forall i=1, 2, \dots, r,\: 0 \leq n_i < k) \}
    \end{array}
  }
  {
    \sigma \vdash \op{ft}{E, (n_1, n_2, \dots, n_r)} \Rar e', c \cup c'
  }
\end{align*}

\begin{align*}
  \forall \mtt{ft} \in \{\mtt{sum}, \mtt{mean}\},
  \bigspace
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      e' = e \indr{1}{n} \conc (1) \conc e \indr{n+2}{k} \\
      c' = \{ (k \geq 1) \land (0 \leq n < k) \}
    \end{array}
  }
  {
    \sigma \vdash \op{ft}{E, n, True} \Rar e', c \cup c'
  }
\end{align*}

\begin{align*}
  \forall \mtt{ft} \in \{\mtt{sum}, \mtt{mean}\},
  \bigspace
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      e_1 = \ifs{1 \in \{n_1, n_2, \dots, n_r\}}{(1)}{(e[1])} \\
      e_2 = \ifs{2 \in \{n_1, n_2, \dots, n_r\}}{(1)}{(e[2])} \\
      \bigspace \cdots \\
      e_k = \ifs{k \in \{n_1, n_2, \dots, n_r\}}{(1)}{(e[k])} \\
      e' = e_1 \conc e_2 \conc \cdots \conc e_k \\
      c' = \{ (k \geq 1) \land (\forall i=1, 2, \dots, r,\: 0 \leq n_i < k) \}
    \end{array}
  }
  {
    \sigma \vdash \op{ft}{E, (n_1, n_2, \dots, n_r), True} \Rar e', c \cup c'
  }
\end{align*}

\begin{align*}
  \forall \mtt{ft} \in \{\mtt{sum}, \mtt{mean}\},
  \bigspace
  \frac
  {
    \sigma \vdash \op{ft}{E, X} \Rar e, c
  }
  {
    \sigma \vdash \op{ft}{E, X, False} \Rar e, c
  }
\end{align*}%}}}

\subsection*{\texttt{torch.nn.Conv2d}}%{{{
\begin{align*}
  \frac
  {
    \begin{array}{l}
      \sigma \vdash E \Rar e, c \\
      k = \op{rank}{e} \\
      w = \left\lfloor \frac{e[3] + 2 \x padding \ind{0} - dilation \ind{0}
        \x (kernel\_size \ind{0} - 1) - 1}{stride \ind{0}} \right\rfloor + 1 \\
      h = \left\lfloor \frac{e[4] + 2 \x padding \ind{1} - dilation \ind{1}
        \x (kernel\_size \ind{1} - 1) - 1}{stride \ind{1}} \right\rfloor + 1 \\
      e' = (e[1], out, w, h) \\
      c_{dim} = \{ (k = 4) \} \\
      c_w = \{ (kernel\_size\ind{0} \leq e[3] + 2 \x padding \ind{0}) \} \\
      c_h = \{ (kernel\_size\ind{1} \leq e[4] + 2 \x padding \ind{1}) \} \\
      c_{group} = \{ (in \rem groups = 0) \land (out \rem groups = 0) \}
    \end{array}
  }
  {
    \sigma \vdash \module{Conv2d}{in, out, kernel\_size, stride, padding,
      dilation, groups}{E} \Rar e', c \cup c_{dim} \cup c_w \cup c_h \cup
      c_{group}
  } \\
  \\
  \text{default values(when omitted): $stride=1, padding=0, dilation=1,
    groups=1$} \\
  \text{$kernel\_size, stride, padding, dilation$는 가로-세로별 2-tuple로도 들어갈
  수 있음} \\
  \text{이 경우를 위해 $stride\ind{0}, stride\ind{1}$으로 표기함} \\
  \text{만일 $stride$가 튜플이 아닌 스칼라라면 $stride\ind{0}$ 또는 $\ind{1}$은
    $stride$ 값 자체를 의미}
\end{align*}%}}}


\end{document}
